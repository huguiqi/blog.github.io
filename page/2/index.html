
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
  <meta name="keywords" content="胡小黑,架构师,资深软件工程师,object-c,swift,java,node,小黑,技术,大牛,阿里巴巴,腾讯,旅游">
  
  
    <title>小黑的技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="sam">
    
    <meta name="baidu-site-verification" content="zBj0BDqjSV" />
    
    <meta name="description" content="胡小黑 大型网络架构">
<meta name="keywords" content="胡小黑,架构师,资深软件工程师,object-c,swift,java,node,小黑,技术,大牛,阿里巴巴,腾讯,旅游">
<meta property="og:type" content="website">
<meta property="og:title" content="小黑的技术博客">
<meta property="og:url" content="http://www.huguiqi.top/page/2/index.html">
<meta property="og:site_name" content="小黑的技术博客">
<meta property="og:description" content="胡小黑 大型网络架构">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小黑的技术博客">
<meta name="twitter:description" content="胡小黑 大型网络架构">
<meta name="twitter:creator" content="@XiaoheiSpring">
<link rel="publisher" href="109318125124422212783">

    
    <link rel="alternative" href="/atom.xml" title="小黑的技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">

</head>

  <body>
    <header>
      
<div>
<p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>

		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="小黑的技术博客" title="小黑的技术博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="小黑的技术博客">小黑的技术博客</a></h1>
				<h2 class="blog-motto">不积跬步无以至千里</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li><a href="http://blog.huguiqi.com.">副站</a></li>
					<li>
 					
						<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" autocomplete="on" class="st-default-search-input"  name="q" maxlength="30" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/20/在google上开通开发者时填入的招商银行双币卡疑似被盗刷/" title="在google上开通开发者时填入的招商银行双币卡疑似被盗刷" itemprop="url">在google上开通开发者时填入的招商银行双币卡疑似被盗刷</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2019-02-20T08:26:00.000Z" itemprop="datePublished"> 发表于 2019-02-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>今天在开通google cloud 的时候，填写了信用卡信息(因为是必填),顺利开通了google cloud并申请了一台vps vm实例用来作shadowsocks 服务器。</p>
<p>但是，过了一会突然发现招商银行信用卡中心给我微信发了两条交易提醒：</p>
<p><img src="http://img.huguiqi.top/1550651474728pkwlcyq1.png?imageslim" alt="paste image"></p>
<p>第一感觉就是不是信用卡被盗了？而且是在google上泄漏出去的，这很严重！！！</p>
<p>网上查了一下，原来是google不支持中国（P.R.C），所以只能”被”成为香港（Hong.Kong）公民了,开通了Visa验证，购买后,就会有以下信息：</p>
<pre><code>您尾号XXXX的招行信用卡于1月21日10时15分网上交易当地币8.00元；
</code></pre><p>因为我只是开通开发者成为开发者，并没有真正购买任何商品，只是作了一下信用卡绑定，这可能是google绑定招行双币卡作了一笔会退还的交易，而我注册的时候选择的是居住地在香港，那8元当地币就是港币，当然，它会在几天内还给你，你不需要担心，详见Google的解释：</p>
<pre><code>Authorizations 
Authorizations occur between our billing system and your bank&apos;s billing system to ensure that the card is valid and the necessary funds are available in your account before the order is charged. Because the order has been cancelled, the pending authorization will not result in a charge. 
You may also notice a $1.00 transaction from Google, which is actually a pending authorization request between our billing system and the bank that issued your credit or debit card, so you won&apos;t end up paying the extra $1.00. 
When you check your bank account or credit card statement, payment authorizations are often listed as &quot;pending.&quot; These transactions might remain in your account between 1-14 business days, depending on your card-issuing bank. Please keep in mind they are authorization requests only, not actual charges. 
Authorizations can remain in your account anywhere from 24 hours up to 14 business days, depending on the bank. You may contact your bank to confirm the charge for your purchase with Google or to check on the authorization status.
</code></pre><p>所以，后面又收到一条交易失败的提醒，吓死老子了，我几千万的资产就可能成负的了。。。。。。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂谈/">杂谈</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/02/20/在google上开通开发者时填入的招商银行双币卡疑似被盗刷/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/02/20/在google上开通开发者时填入的招商银行双币卡疑似被盗刷/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/20/google-cloud-vm建免费vps/" title="google cloud vm建免费vps" itemprop="url">google cloud vm建免费vps</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2019-02-20T06:49:47.000Z" itemprop="datePublished"> 发表于 2019-02-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Google-Cloud-Platform免费申请-amp-一键搭建SSR-amp-BBR加速教程"><a href="#Google-Cloud-Platform免费申请-amp-一键搭建SSR-amp-BBR加速教程" class="headerlink" title="Google Cloud Platform免费申请&amp;一键搭建SSR &amp; BBR加速教程"></a>Google Cloud Platform免费申请&amp;一键搭建SSR &amp; BBR加速教程</h1><p><img src="http://img.huguiqi.top/1550645437458oolft1bo.png?imageslim" alt="paste image"></p>
<ol>
<li>Google Cloud Platform (GCP) 简介<br>Google Cloud Platform (以下简称GCP)是Google提供的云平台, 可以用来搭建加速服务, 网站和存储数据等等, 本文将介绍如何申请GCP一年的免费试用、Linux服务器环境搭建、配置BBR加速以及安装SSR等服务端. 网上关于如何搭建GCP的教程很多, 不过都不是太详尽. 如果你是没基础的新手, 或者像下图这位童鞋踩到坑不知所措的话, 希望这篇教程能帮到你 🙂</li>
</ol>
<p>Google Cloud Platform搭建问题</p>
<ol>
<li>Google Cloud Platform 优势<br>大家用得比较多的可能是Linode, 搬瓦工, Vultr等VPS, 收费$5-$20美金左右.<br>最近LinodeIP段也封得比较多, 基本上开十多台机器都难找到能PING通的IP.<br>另外还有各种VP/恩基本都挂了.<br>至于XX路由器, 本质上只是刷了个固件内置了SS服务而已, 略过不提.</li>
</ol>
<p>GCP的优势在于:</p>
<p>免费<br>Google云服务平台对新用户赠送300美元, 可以免费使用1年.<br>并且到期后如果不打算续费, 也不会额外收取费用 (像亚马逊AWS就直接扣你费用了).<br>如果还想继续用, 直接新注册个账号, 免费 🙂<br>用来搭SS的话, 最低配置的机型$5/月, 出口大陆流量1T以内为0.23$/1G, 算下来每个月可用80多G的流量, 足够用了, 当然你还可以顺便搭个网站之类的 🙂<br>GCP 300美元一年免费试用<br>速度快<br>Google GCP有美国, 亚洲, 欧洲等机房, 而亚洲机房就在厦门正对面的台湾省彰化县, TTL只有40ms左右，快到飞起, 而Linode、Vultr等通常是200多；</p>
<p><img src="http://img.huguiqi.top/1550645478291dta7czwt.png?imageslim" alt="paste image"></p>
<ol>
<li><p>需要准备的东西<br>Gmail账号<br>双币信用卡 (淘宝购买的虚拟卡无法使用, 不要浪费钱)<br>Xshell: SSH客户端 (也可用Google自带的在线SSH, 以后比较方便).<br>Xshell不建议用绿色版, 某些电脑没装运行库的话可能无法打开.<br>另外之前官方5.0 Build 1322版本存在后门, 所以还是去官网下载最新的安装版吧.<br>Xshell 6官网下载地址点我, 目前家庭与学校用户可免费使用. 填写姓名和邮箱并提交表单后, 邮箱会收到下载链接.<br>puttygen: SSH密钥生成工具. 官网下载地址: puttygen 32位 , puttygen 64位<br>能访问Google (额, 这貌似是个悖论, 你可以先找其他临时方案)<br>需要一定动手能力以及Linux系统基础知识, 想省事或遇到问题的, 请找人工付费服务…<br>废话不多说,下面直接上教程:</p>
</li>
<li><p>申请Google Cloud Platform<br>4.1 注册<br>申请地址: <a href="https://cloud.google.com/free/" target="_blank" rel="noopener">https://cloud.google.com/free/</a></p>
</li>
</ol>
<p><img src="http://img.huguiqi.top/1550645534869jqqmk5f5.png?imageslim" alt="paste image"></p>
<p>Google Cloud Platform 免费试用<br>点击免费试用, 登入Gmail账号.<br>地区选中国.</p>
<p><img src="http://img.huguiqi.top/1550645557551lan7x677.png?imageslim" alt="paste image"></p>
<p>账号类型选个人, 接下来输入账单地址以及信用卡信息. Google会从信用卡扣除1美元用于验证, 验证完成后会退还到账户.<br>点击开始免费试用.</p>
<p>4.2 激活结算账号<br>注册成功后可能并不能马上使用 (国内注册的基本都需要激活, 当然也不排除你人品好的情况), Gmail邮箱会受到一封标题为紧急通知：您的结算帐号 XXXXX 已经被暂停使用的邮件, 你需要点击邮件中的链接, 上传身份证和信用卡照片完成验证 (信用卡照片可以遮住或PS掉敏感信息, 只保留最后四位, 自己看页面提示), 一般提交后10分钟左右就能收到通过的邮件, 验证完成后就可以正常使用了.</p>
<p>这一步很多人会忽略, 结果就是创建实例的时候会不停提示你Enable Billing Account, 但是指引界面又没有明确说明要怎么激活, 即使是进到账号管理界面也无法自己开启. 所以别忘了去喵一眼你的邮箱 🙂</p>
<p><img src="http://img.huguiqi.top/1550645633146sc8anwy9.png?imageslim" alt="paste image"></p>
<p>邮件: 紧急通知：您的结算帐号 XXXXX 已经被暂停使用<br>结算账号验证成功后会显示消息:</p>
<p><img src="http://img.huguiqi.top/155064566991862c1mypz.png?imageslim" alt="paste image"></p>
<p>结算账号验证成功消息<br>4.3 修改防火墙规则<br>有的文章是先创建实例再改规则.<br>我们先修改防火墙规则, 后面会省事一点.</p>
<p><img src="http://img.huguiqi.top/1550645708034sj9y13cj.png?imageslim" alt="paste image"></p>
<p>直接访问 <a href="https://console.cloud.google.com/networking/firewalls/list" target="_blank" rel="noopener">https://console.cloud.google.com/networking/firewalls/list</a></p>
<p>Google Cloud Platform 防火墙规则<br>点击创建防火墙规则, 按下图设置:</p>
<p><img src="http://img.huguiqi.top/15506457319939ssxmqpy.png?imageslim" alt="paste image"></p>
<p>Google Cloud Platform 创建防火墙规则<br>注意IP地址范围是0.0.0.0/0, 别写错了.<br>有遇到过有人写成0.0.0.0, 结果后来怎么试都不成功的.</p>
<p>4.5 创建计算引擎<br>4.5.1 创建实例</p>
<p>直接访问 <a href="https://console.cloud.google.com/compute/instances" target="_blank" rel="noopener">https://console.cloud.google.com/compute/instances</a><br>或登录GCP控制台后, 点击计算引擎 – 创建实例. 如图:</p>
<p>名称: 随便填<br>地区: 建议选asia-east1-c<br>asia-east1-a, asia-east1-b, asia-east1-c 机房都在中国台湾彰化县, 实测c区更好.</p>
<p><img src="http://img.huguiqi.top/1550645905180a22csqj8.png?imageslim" alt="paste image"></p>
<p>4.5.2 生成静态IP<br>点击网络选项卡—外部IP—创建IP地址.</p>
<p><img src="http://img.huguiqi.top/1550645997523jarg291u.png?imageslim" alt="paste image"></p>
<p>Google运服务器-创建实例-网络选项卡<br>外部IP,创建IP地址<br>创建IP地址<br>然后会提示输入名称, 任意输入即可(小写字母开头,不能为大写字母)</p>
<p>保留新的静态IP地址<br>补充说明<br>关于IP会有静态和临时两个选项.<br>推荐选择静态, 选择临时的话机器重启后会重新分配IP地址.</p>
<p><img src="http://img.huguiqi.top/155064606590858rawbmd.png?imageslim" alt="paste image"></p>
<p>更多信息可以去Dashboard中的网络 – VNC网络 – 外部IP地址或直接点击<a href="https://console.cloud.google.com/networking/addresses/list查看" target="_blank" rel="noopener">https://console.cloud.google.com/networking/addresses/list查看</a>.</p>
<p>把创建好的IP记下来, 用Xshell连接的时候会用到.</p>
<p>静态IP一定记得绑定到实例.<br>已分配但未被使用的IP, 会按$0.01/小时计费.</p>
<p>4.5.3上传SSH公钥<br>点击SSH密钥选项卡</p>
<p>Google Cloud Platform - 创建实例 - SSH密钥选项卡<br>在上图文本框内填入4.4.1步骤中puttygen中生成的公钥, 注意是下图中蓝色部分的内容, 直接全选并复制, 再粘贴过来即可.</p>
<p>最后点击最底部的创建按钮, 创建实例.</p>
<p>页面左下角会提示正在创建实例, 实际等待10秒左右即可创建完成并启动.</p>
<p>正在创建GCP VM实例<br>VM实例管理界面第一列中绿色的对勾图标表示该实例正在运行, 第五列为实例的外部IP, 也就是下一步用Xshell连接时需要用到的主机IP地址.</p>
<ol>
<li>一键安装最新内核并开启BBR脚本<br>BBR要求系统内核版本为4.9以上, 本文采用teddysun的脚本, 支持一键自动判断和安装所需内核版本并开启BBR.</li>
</ol>
<p>5.1 连接XShell<br>通过Xshell连接到Google Cloud VPS.</p>
<p>主机: 之前步骤创建的静态IP, 也可在GCP VM实例的管理界面查看.<br>端口: 默认的22端口<br>用户名: 如你的gmail邮箱是username@gmail.com, 则用户名是username<br>密钥: 使用之前puttygen生成的私钥, 导入即可.</p>
<p>有的小伙伴不会用Xshell, 补充几张图片:</p>
<p>Google也自带了在线SSH, 实例创建好后, 在列表界面点击SSH – 在浏览器窗口中打开即可进入, 见下图.<br>不过出于个人习惯, 用Xshell本地进行连接管理更方便, 不用每次都打开浏览器进GCP后台.</p>
<p>5.2 运行BBR脚本<br>通过脚本一键升级内核并安装BBR加速.</p>
<p>Linux系统中root用户拥有最高权限, 出于安全考虑, GCP默认是以普通用户登录的, 我们需要先切换到root用户, 否则运行某些命令时会提示无权限.</p>
<p>先切换到root用户.<br>Xshell连上服务器后, 输入命令:<br>sudo -i</p>
<p>切换后, 命令前面的提示符中也会显示root, 如图:</p>
<p>依次运行以下4条命令</p>
<p>yum install -y wget<br>wget –no-check-certificate <a href="https://github.com/teddysun/across/raw/master/bbr.sh" target="_blank" rel="noopener">https://github.com/teddysun/across/raw/master/bbr.sh</a><br>chmod +x bbr.sh<br>./bbr.sh<br>安装完成后，脚本会提示需要重启VPS，输入 y 并回车后重启, 这时Xshell连接也会自动断开。</p>
<p>VPS重启可能需要几分钟, 耐心等待一下.</p>
<p>重启完成后，再用Xhell重新连接VPS, sudo -i切换到root用户.</p>
<p>现在验证一下是否成功安装了最新内核并开启BBR.<br>输入以下命令：</p>
<p>uname -r<br>查看内核版本，如果返回值含有4.13或以上版本, 就表示OK了.</p>
<p>sysctl net.ipv4.tcp_available_congestion_control<br>返回值一般为：<br>net.ipv4.tcp_available_congestion_control = bbr cubic reno</p>
<p>sysctl net.ipv4.tcp_congestion_control<br>返回值一般为：<br>net.ipv4.tcp_congestion_control = bbr</p>
<p>sysctl net.core.default_qdisc<br>返回值一般为：<br>net.core.default_qdisc = fq</p>
<p>lsmod | grep bbr<br>返回值有 tcp_bbr 模块即说明bbr已启动。</p>
<ol>
<li>安装SSR<br>本文采用秋水逸冰的Shadowsocks一键安装脚本(四合一).<br>依次运行以下3条命令:</li>
</ol>
<p>2017.12.3更新: 记得先用sudo -i命令切换到root用户, 不然会显示This script must be run as root! 见下图:</p>
<p>wget –no-check-certificate -O shadowsocks-all.sh <a href="https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh</a><br>chmod +x shadowsocks-all.sh<br>./shadowsocks-all.sh 2&gt;&amp;1 | tee shadowsocks-all.log<br>注意: 前面两行命令其实是同一行, 因为网页排版的问题显示成2行了, 直接把这两行都复制, 再粘贴到Xshell即可. 好多人在这一步出错, 特意提醒下. 具体看截图:</p>
<p>然后是选择SSR版本, 设置端口、密码、加密方式等等，之前的 SSR安装教程有详细步骤， 此处略过.</p>
<p>安装好之后即可通过客户端进行连接与测速.</p>
<p>最后附上测速:</p>
<p>小飞机客户端的使用请参考:</p>
<p>ShadowsocksR客户端 各种隐藏使用技巧说明<br>SSR 安卓 &amp; 苹果 Iphone, Ipad一键设置教程.</p>
<ol>
<li>关于流量与扣费<br>Google Cloud Platform计算引擎是按小时收费，网络按流量收费.<br>我们掏出笔来算一算:<br>注册赠送了300美金, 一年免费使用期.</li>
</ol>
<p>主机我们选的是微型(最低配置机型), $5/月.<br>还剩300-5*12=$240, 用于抵扣流量的费用.<br>谷歌云服务器出口大陆流量1T以内价格约为0.23$/1G.<br>那么每个月可用流量 = 240/12/0.23 ≈ 86G, 一般日常使用绝对够用, 当然你还可以顺便搭个网站之类的 🙂</p>
<ol>
<li>如何查看使用量及余额<br>进入结算概览页面: <a href="https://console.cloud.google.com/billing/" target="_blank" rel="noopener">https://console.cloud.google.com/billing/</a></li>
</ol>
<p>可以看到剩余的赠金和天数.<br>点击左侧交易, 以及图中下方相关联的项目名称, 可以查看使用量和扣费明细.</p>
<p>结算概览查看使用量明细和赠金余额</p>
<ol>
<li><p>增加Swap交换分区与调优<br>GCP默认没有Swap交换分区, 如果0.6G内存不够用, 可以手动增加Swap交换分区并且调整对应的内核参数. 参考文章: Google Cloud Platform 增加Swap交换分区与调优</p>
</li>
<li><p>如何开启root登录 (非必须)<br>出于安全因素, Google Cloud Platform默认是以普通用户密钥认证的方式登录的, 禁止root登录. 如需要root权限可以使用命令sudo -i进行切换.<br>如果需要直接使用root登录,按如下设置:</p>
</li>
</ol>
<p>先切换到root<br>sudo -i</p>
<p>创建.ssh目录并修改权限, 然后复制普通用户的密钥文件到root相应目录下. 用户名注意换成你自己的.<br>mkdir .ssh &amp;&amp; chmod 700 .ssh &amp;&amp; cp /home/你的gmail用户名/.ssh/authorized_keys .ssh</p>
<p>修改SSH配置文件<br>vim /etc/ssh/sshd_config<br>将PermitRootLogin no改为PermitRootLogin yes并保存</p>
<p>重启SSH服务<br>systemctl restart sshd.service</p>
<p>测试是否设置成功</p>
<ol>
<li>FAQ<br>Q: 运行某些命令提示 <em>*</em> Operation not permitted或者You need to be root to perform this command.?<br>A: 一般是权限不够. 管理GCP时, 记得先sudo -i切换到root用户, 否则某些命令无法运行.</li>
</ol>
<p>Q: 区域选的是asia-east1-c台湾机房, 为什么ping显示是美国IP?<br>A: 正常. Ping测试不准. IP地址是谷歌从美国申请的, 但是可用于全球任何一个机房, 因为谷歌是采用网间结算(IP Transit)服务，直接指定部分段与某地区运营商进行连接. 详细机房位置参考: <a href="https://cloud.google.com/compute/docs/regions-zones/#available" target="_blank" rel="noopener">https://cloud.google.com/compute/docs/regions-zones/#available</a>. 另外可用tracert或mtu命令测试路由与节点. Ping的话建议www.ipip.net.</p>
<p>Q: 还能更快吗?<br>A: 可以, 关键词: 魔改版BBR, 自行搜索</p>
<p>Q: 装BBR脚本时, 手动更换内核，重启后，整个磁盘变为只读怎么办?<br>A: 执行命令mount -o remount rw /即可恢复.</p>
<p>Q: 根据谷歌的Always Free政策, us-east1, us-west1, and us-central1这三个地区的微型机器永久免费, 能用吗?<br>A: 可以忽略. 流入中国和澳大利亚的流量要收费, 如下图. 更多限制政策请参考: <a href="https://cloud.google.com/compute/pricing#freeusage" target="_blank" rel="noopener">https://cloud.google.com/compute/pricing#freeusage</a><br>Google Cloud Platform的Always Free政策使用限制<br>Q: Google Cloud Platform能用来建站吗?<br>A: 当然可以, 不过长期建站还是推荐用Linode. GCP流量是要扣费的. 另外外贸站建议机房使用目标客户所在国家. 国内站的话, 反正百度是不咋待见国外服务器的.</p>
<p>转：<a href="https://www.wmsoho.com/google-cloud-platform-ssr-bbr-tutorial" target="_blank" rel="noopener">https://www.wmsoho.com/google-cloud-platform-ssr-bbr-tutorial</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/02/20/google-cloud-vm建免费vps/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/02/20/google-cloud-vm建免费vps/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/16/docker日志问题导致磁盘空间被占用/" title="docker日志问题导致磁盘空间被占用" itemprop="url">docker日志问题导致磁盘空间被占用</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2019-02-16T12:15:00.000Z" itemprop="datePublished"> 发表于 2019-02-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="docker日志问题导致磁盘空间不足"><a href="#docker日志问题导致磁盘空间不足" class="headerlink" title="docker日志问题导致磁盘空间不足"></a>docker日志问题导致磁盘空间不足</h1><p>昨天突然发现本厂开发环境各个docker实例都处于非健康状态，在宿主机上执行命令：</p>
<pre><code>df -h
</code></pre><p>发现docker相关的文件占用空间是100%：</p>
<p><img src="http://img.huguiqi.top/1550319498360gfiveq9s.png?imageslim" alt="paste image"></p>
<p>有点不正常，我看看docker相关的文件占用情况，是镜像占用的还是容器占用的，或者是Volumes占用的，执行：</p>
<pre><code>docker system df
</code></pre><p>这里面显示一切正常，也并没有超过挂载盘的大小256G。</p>
<p>首先把多余的镜像和不用的docker都清理掉。</p>
<p>执行命令：</p>
<pre><code>docker system prune -a
</code></pre><p>可以将没有容器使用Docker镜像和未开启的容器都删掉。</p>
<p>我看到占用超过226G空间的都来自 <code>/mnt/docker/overlay2/*</code> 这个目录,<br>进入到这个目录，并执行：</p>
<pre><code>du -lbhs ./*
</code></pre><p>发现这里面也没有超过2个G的目录文件大小。</p>
<p>我潜意识里就觉得八成是日志导致的，所以我首先看看是不是我所有的docker输出的日志文件是否需要清理了，我到挂载目录里去看看，果然发现了很多docker容器的日志目录就占了1-2个G，我du -lbhs 了一下，发现所有容器挂载的日志目录加起来的容量才8G多点，不足以占用256个G的空间。<br>算了，先把这8个G的占用清了吧。</p>
<pre><code>rm -rf ./*/logs/*
</code></pre><p>然后我再看看docker容器本身还有多少占用的空间情况：</p>
<pre><code>docker ps --size
</code></pre><p>发现还有两个docker占用了3个多占的空间，但是又不知道具体是什么导致的，那我只能看看docker本身的硬盘占用情况了：</p>
<pre><code>docker diff &lt;container&gt;
</code></pre><p>发现<code>/tmp</code> 目录下有好多文件：</p>
<p><img src="http://img.huguiqi.top/15503217004152bmdcd14.png?imageslim" alt="paste image"></p>
<p>还有指向<code>/tmp/tomcat.*/*</code> 相关的目录：</p>
<p><img src="http://img.huguiqi.top/1550321770403ggnsq3dy.png?imageslim" alt="paste image"></p>
<p>我觉得八成就是这些东西占用的，/tmp 临时文件按道理讲系统会自动删除的，不知道为什么没有删除，这个后面再找原因。<br>我就把所有docker容器里的<code>/tmp</code>目录下的文件全部删除，反正是临时文件。</p>
<pre><code>docker exec &lt;container&gt; rm -rf /tmp/*
</code></pre><p>好，都删除了，再看一下硬盘空间，发现还是已使用100%。</p>
<p>怎么办，有点慌了，我看这个指向的还是overlay2目录，我尝试着在目录里找找问题。</p>
<p>我想，这个overlay2目录可能有挂载或者链接，它自身并不大，是挂载的目录占用大。</p>
<p>我们往上一级再看看哪个文件占用空间大：</p>
<pre><code>cd ..
du -lbhs ./*
</code></pre><p>发现有几个contarins目录下的目录文件占用挻大的：</p>
<p><img src="http://img.huguiqi.top/1550320388470wopcicty.png?imageslim" alt="paste image"></p>
<p>我就从最大的目录下手，占用空间7.4G的，是8972f…..这个目录，我进去看一眼：</p>
<p><img src="http://img.huguiqi.top/1550320522538gmcr7qay.png?imageslim" alt="paste image"></p>
<p>我发现里面有个后缀为<code>xxxx-json.log</code>的这个文件占了198G，这个就是问题了，很兴奋，赶紧删除了：</p>
<pre><code>rm -rf ./*/*.log
</code></pre><p>这个就把所有的contarner的控制台日志文件删除了。</p>
<p>我们再看看docker的空间占用情况：</p>
<p><img src="http://img.huguiqi.top/1550322418176dwe2uam6.png?imageslim" alt="paste image"></p>
<p>这里已经很好了，只有镜像占用了1个多G。</p>
<p>我们再来看看宿主机的空间情况：</p>
<pre><code>df -h
</code></pre><p>发现还是100%，见鬼了：</p>
<p><img src="http://img.huguiqi.top/1550319498360gfiveq9s.png?imageslim" alt="paste image"></p>
<p>一般觉得见鬼了的时候，只有两种情况，一种是你操作错了别的东西，一种是缓存，我觉得是后者。</p>
<p>我觉得肯定是docker还没有读到真实的容器占用硬盘空间的数据，那我只能重启docker了：</p>
<pre><code>systemctl daemon-reload 

systemctl restart docker
</code></pre><p>为了确认一切顺利，运行:</p>
<pre><code>docker info
</code></pre><p>ok，没有问题了，再执行 <code>df -h</code><br>很好：</p>
<p><img src="http://img.huguiqi.top/1550322879853rhx6bckp.png?imageslim" alt="paste image"></p>
<p>已经只占用挂载磁盘 <code>/dev/vdbd1</code>总大小的2%。</p>
<p>看来后面还是要写一个自动删除日志的脚本，来维持硬盘空间的大小。</p>
<p><a href="https://github.com/moby/moby/issues/33775" target="_blank" rel="noopener">参考文章1</a></p>
<p><a href="https://meta.discourse.org/t/var-lib-docker-overlay2-took-all-the-disk-space/84624" target="_blank" rel="noopener">参考文章2</a></p>
<p><a href="https://stackoverflow.com/questions/46672001/is-it-safe-to-clean-docker-overlay2" target="_blank" rel="noopener">参考文章3</a></p>
<p><a href="https://blog.csdn.net/weixin_32820767/article/details/81196250" target="_blank" rel="noopener">参考文件章4</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/IT-运维/">IT&运维</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/02/16/docker日志问题导致磁盘空间被占用/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/02/16/docker日志问题导致磁盘空间被占用/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/14/大数据之数据仓库/" title="大数据之数据仓库" itemprop="url">大数据之数据仓库</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2019-02-14T05:18:00.000Z" itemprop="datePublished"> 发表于 2019-02-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="大数据之数据仓库"><a href="#大数据之数据仓库" class="headerlink" title="大数据之数据仓库"></a>大数据之数据仓库</h1><h2 id="什么是数据仓库"><a href="#什么是数据仓库" class="headerlink" title="什么是数据仓库"></a>什么是数据仓库</h2><p>数据仓库，英文名称Data Warehouse，简写为DW。数据仓库顾名思义，是一个很大的数据存储集合。数据仓库必须满足主题性、集成性、稳定性、时变性这些特征。</p>
<p>数据仓库的输入方是各种各样的数据源，最终的输出用于企业的数据分析、数据挖掘、数据报表等方向。</p>
<p><img src="http://img.huguiqi.top/1550125093251lvxgy9x9.png?imageslim" alt="paste image"></p>
<h3 id="数据仓库的特征"><a href="#数据仓库的特征" class="headerlink" title="数据仓库的特征"></a>数据仓库的特征</h3><blockquote>
<blockquote>
<p>什么样的数据表现形式才能叫数据仓库？</p>
</blockquote>
</blockquote>
<p>1.主题性</p>
<p>不同于传统数据库对应于某一个或多个项目，数据仓库根据使用者实际需求，将不同数据源的数据在一个较高的抽象层次上做整合，所有数据都围绕某一主题来组织。</p>
<p>这里的主题怎么来理解呢？比如对于滴滴出行，“司机行为分析”就是一个主题，对于链家网，“成交分析”就是一个主题。</p>
<p>2.集成性</p>
<p>数据仓库中存储的数据是来源于多个数据源的集成，原始数据来自不同的数据源，存储方式各不相同。要整合成为最终的数据集合，需要从数据源经过一系列抽取、清洗、转换的过程。</p>
<p>3.稳定性</p>
<p>数据仓库中保存的数据是一系列历史快照，不允许被修改。用户只能通过分析工具进行查询和分析。</p>
<p>4.时变性</p>
<p>数据仓库会定期接收新的集成数据，反应出最新的数据变化。这和特点并不矛盾。</p>
<p>~~
        
        
        <p class="article-more-link">
          
            <a href="/2019/02/14/大数据之数据仓库/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/大数据/">大数据</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/数据仓库/">数据仓库</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/02/14/大数据之数据仓库/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/02/14/大数据之数据仓库/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/10/2019新征途/" title="2019新征途" itemprop="url">2019新征途</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2019-02-10T15:54:38.000Z" itemprop="datePublished"> 发表于 2019-02-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="回顾2018"><a href="#回顾2018" class="headerlink" title="回顾2018"></a>回顾2018</h1><p>2018年对于我来说注定是一个复杂的一年，工作方面，遭遇了一家金融公司的倒闭，也让我在金钱方面也蒙受了不少损失，大概在两万多元左右。最让我吃亏的是社保公积金因为此事停缴了两个月，至此我离在上海买房的目标越来越远了。。。。。。</p>
<h2 id="工作方面"><a href="#工作方面" class="headerlink" title="工作方面"></a>工作方面</h2><p>2018年4月，我回到了那个曾经熟悉但又陌生的工作环境，说熟悉，这是我<br>的老东家，我的老上司也在，说陌生，是因为感觉到这个公司已经完全不是我当年离开时的那个味道了，甚至公司名称都改成了xx网络科技有限公司了，回来主要是受老上司的邀请，共同解决大数据量的酒店相关后端服务的。我的到来，刚开始确实为公司，为团队解决了很多棘手的问题，关于这一点，我很欣慰。</p>
<p>2018年7月，还是应老上同邀请，拉我一起从这个熟悉而陌生的环境出来，<br>去一家可能比较有前任的创业公司，我非常欣赏我的上司，可以说，这么多年，我更多的是把他当作朋友（也作良师益友吧），我也觉得，在目前这家公司一直待下去，确实也学不到什么东西，还不如和志气相同的人一起做些有意义的事，毕竟，我也不是第一次干了，何况这家创业公司的老板也是我们共同看好的人，所以我也欣然同去了。</p>
<p>2019年1月，在创业公司经过半年的发展与探索，老板发现，我们的发展模<br>式非常有问题，并迅速停止了所有的业务。</p>
<p>2019年1月底，老板将这家创业公司部分骨干人员并入到一家新的酒店行业<br>的类独角兽——嗨住。嗨住团队是一个非常有互联网精神的团队，他们的氛围，我感觉我挻喜欢。合并后，我们产生了一家新的公司，名字叫——慧住。</p>
<p>以上是我2018年的全部工作历程，很曲折，也很无奈。</p>
<p>而回顾2018年，我立下的flag又有哪些已经兑现了呢？</p>
<blockquote>
<blockquote>
<p>将服务端技术提升上一个台阶<br>帮助老朋友解决掉目前的困难<br>让漂泊的心暂时稳定下来<br>考驾照<br>往架构师方向发展 </p>
</blockquote>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2019/02/10/2019新征途/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/02/10/2019新征途/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/02/10/2019新征途/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/07/spring-cloud-oauth2与前端跨域问题/" title="spring-cloud oauth2与前端跨域问题" itemprop="url">spring-cloud oauth2与前端跨域问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2019-01-07T12:07:38.000Z" itemprop="datePublished"> 发表于 2019-01-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>架构是前后端分离的，也就是说前端可能是在不同的服务器，甚至在不同域名下的。<br>那这样的话，势必有跨域问题，而正常的跨域问题，springboot都已经提供了解决方案，即在BackGatewayApplication启动类上添加如下filter:</p>
<pre><code>@Bean
    public CorsFilter corsFilter() {
        final UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        final CorsConfiguration config = new CorsConfiguration();
        config.setAllowCredentials(true);
        config.addAllowedOrigin(&quot;*&quot;);
        config.addAllowedHeader(&quot;*&quot;);
        config.addAllowedMethod(&quot;OPTIONS&quot;);
        config.addAllowedMethod(&quot;HEAD&quot;);
        config.addAllowedMethod(&quot;GET&quot;);
        config.addAllowedMethod(&quot;PUT&quot;);
        config.addAllowedMethod(&quot;POST&quot;);
        config.addAllowedMethod(&quot;DELETE&quot;);
        config.addAllowedMethod(&quot;PATCH&quot;);
        source.registerCorsConfiguration(&quot;/**&quot;, config);
        return new CorsFilter(source);
    }
</code></pre><p>或者还有更方便的：</p>
<pre><code>@CrossOrigin(origins = &quot;*&quot;)
public class BackGatewayApplication {
    .....
}
</code></pre><p>目前遇到的问题是，前端通过ajax请求，如果传了一个失效的token，则前端会直接报错，显示的是这样的：</p>
<pre><code>Access to XMLHttpRequest at &apos;http://127.0.0.1:9002/rios-upms/authUser/test&apos; from origin &apos;http://www.runoob.com&apos; has been blocked by CORS policy: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource.
</code></pre><p>看着像是说跨域问题。</p>
<p>但是，我们之前遇到的跨域大部分是浏览器的行为，将请求拦截了，但是这个不同的是他的请求发出去了，服务端也接收到了请求，并返回了，返回的失效token的提示，通过postman或者curl工具能正常返回，并且还有状态码：</p>
<p><img src="http://img.huguiqi.top/1546866135627qlw7n1a0.png?imageslim" alt="paste image"></p>
<p>但是通过ajax请求浏览器访问，却总是出现error,以下是用jquery的ajax请求：</p>
<pre><code>$(document).ready(function(){
    $(&quot;button&quot;).click(function(){
        $.ajax({
                url:&quot;http://bgateway.riosclub.com/rios-upms/authUser/findMenu&quot;,
                headers: {
                    Accept: &quot;application/json; charset=utf-8&quot;,
                    Authorization: &quot;Bearer Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NDY2MTYyMzAsInVzZXJfbmFtZSI6InhpYW9oZWkiLCJhdXRob3JpdGllcyI6WyJVU0VSIiwiQURNSU4iXSwianRpIjoiNTc5NzcwZjUtYjU5OC00ZGU2LWFjODktNGI2YzM3Mjg0ZTAzIiwiY2xpZW50X2lkIjoiY2xpZW50YXBwIiwic2NvcGUiOlsiYWxsIl19.b-E1XXWuUZuq61eIkJ07LWjDkUY4P5CpP8_kRNKz-7A&quot;
                },
                type: &quot;post&quot;,
                success:function(result){
                    alert(&apos;success&apos;);
                    console.log(JSON.stringify(result));
                    $(&quot;#div1&quot;).html(result);
                },
                fail: function(e){
                    alert(&apos;fail&apos;);
                    alert(e);
                },
             error: function(xhr,status,error){
                 alert(&apos;error&apos;);
                 console.log(JSON.stringify(xhr));
                 console.log(JSON.stringify(status));
                 console.log(JSON.stringify(error));

             },
            complete: function(xhr,status){
                alert(&apos;complete&apos;);
                alert(JSON.stringify(xhr));
                alert(&apos;complete&apos; + status);
            }
               });
    });
});
</code></pre><p>调用ajax请求后，总是直接调用了error的回调方法，并在控制台打印：</p>
<p><img src="http://img.huguiqi.top/1546874949672jvi5ks3f.png?imageslim" alt="paste image"></p>
<p>打印的xhr是：</p>
<pre><code>{&quot;readyState&quot;:0,&quot;responseText&quot;:&quot;&quot;,&quot;status&quot;:0,&quot;statusText&quot;:&quot;error&quot;}
</code></pre><h3 id="关于readystate五个状态总结"><a href="#关于readystate五个状态总结" class="headerlink" title="关于readystate五个状态总结"></a>关于readystate五个状态总结</h3><h4 id="readyState-状态-状态说明"><a href="#readyState-状态-状态说明" class="headerlink" title="readyState 状态    状态说明"></a>readyState 状态    状态说明</h4><ul>
<li>(0)未初始化</li>
</ul>
<p>此阶段确认XMLHttpRequest对象是否创建，并为调用open()方法进行未初始化作好准备。值为0表示对象已经存在，否则浏览器会报错－－对象不存在。</p>
<ul>
<li>(1)载入</li>
</ul>
<p>此阶段对XMLHttpRequest对象进行初始化，即调用open()方法，根据参数(method,url,true)完成对象状态的设置。并调用send()方法开始向服务端发送请求。值为1表示正在向服务端发送请求。</p>
<ul>
<li>(2)载入完成</li>
</ul>
<p>此阶段接收服务器端的响应数据。但获得的还只是服务端响应的原始数据，并不能直接在客户端使用。值为2表示已经接收完全部响应数据。并为下一阶段对数据解析作好准备。</p>
<ul>
<li>(3)交互</li>
</ul>
<p>此阶段解析接收到的服务器端响应数据。即根据服务器端响应头部返回的MIME类型把数据转换成能通过responseBody、responseText或responseXML属性存取的格式，为在客户端调用作好准备。状态3表示正在解析数据。</p>
<ul>
<li>(4)完成</li>
</ul>
<p>此阶段确认全部数据都已经解析为客户端可用的格式，解析已经完成。值为4表示数据解析完毕，可以通过XMLHttpRequest对象的相应属性取得数据。<br>概而括之，整个XMLHttpRequest对象的生命周期应该包含如下阶段：<br>创建－初始化请求－发送请求－接收数据－解析数据－完成</p>
<p>readyState为0，了解了一下，出现这种情况，xhr中readyState为0的几种情况：</p>
<p>引用官方对XMLHttpRequest的说明：</p>
<p><a href="http://www.w3.org/TR/XMLHttpRequest/" target="_blank" rel="noopener">http://www.w3.org/TR/XMLHttpRequest/</a></p>
<blockquote>
<blockquote>
<p>The status attribute must return the result of running these steps:</p>
</blockquote>
</blockquote>
<p>status的值一定会返回运行这些步骤的结果。</p>
<ul>
<li>1、If the state is UNSENT or OPENED, return 0.（如果状态是UNSENT或者OPENED，返回0）</li>
<li>2、If the error flag is set, return 0.（如果错误标签被设置，返回0）</li>
<li>3、Return the HTTP status code.（返回HTTP状态码）</li>
</ul>
<p>而根据我得到的error错误，第一反应是跨域访问，被浏览器拒绝了，但是，关键是我服务端收到了请求。</p>
<p>还有一种情况，也是会导致state的状态为0的，就是：</p>
<p>If the cross-origin request status is network error</p>
<pre><code>This is a network error.
</code></pre><p>虽然去访问了，应该是浏览器跨域的返回头没有被允许，所以浏览器阻止返回的响应，Access-Control-Allow-Origin 浏览器没有发现这个属性的设置，所以就报跨域，也就是服务器在响应头里也要设置跨域处理，不然也会出现这种情况。</p>
<p>那么，我就在response的header设置一下：</p>
<pre><code>httpServletResponse.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);
</code></pre><p>再次访问，就得到了状态码：</p>
<p><img src="http://img.huguiqi.top/15468766676916dme9nbx.png?imageslim" alt="paste image">![paste image]</p>
<p>而这次是在complete方法里取得了xhr:</p>
<pre><code>{&quot;readyState&quot;:4,&quot;responseText&quot;:&quot;{\&quot;msg\&quot;:\&quot;无效的token\&quot;,\&quot;code\&quot;:401}&quot;,&quot;responseJSON&quot;:{&quot;msg&quot;:&quot;无效的token&quot;,&quot;code&quot;:401},&quot;status&quot;:403,&quot;statusText&quot;:&quot;error&quot;}
</code></pre><p>得到的状态值是4，status值是403。</p>
<p>在这里还没完，因为我用的是security+oauth2,在gateway处理所有资源请求的权限认证的，而在oauth2这里，确有个头疼的问题，在token失效的时候，我就拿不到readyState，也一直是0，说这个问题的之前，先来说下我的架构。</p>
<h2 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h2><p>目前我的服务请求流程大致是这样：</p>
<p><img src="http://img.huguiqi.top/1546865302940pgu0d42v.png?imageslim" alt="paste image"></p>
<p>所有的资源请求都经过gateway转发并在gateway认证(在oauth2里把gateway作为一个总的资源服务器配置来校验各资源服务器的权限)，调用认证服务器去校验token的正确性。</p>
<p>而oauth2的工作流程大致是：</p>
<p>OAuth2AuthenticationProcessingFilter：</p>
<pre><code>public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {
    .......

    Authentication authResult = this.authenticationManager.authenticate(authentication);
    ......
}
</code></pre><p>然后是OAuth2AuthenticationManager:</p>
<pre><code>public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        if(authentication == null) {
            throw new InvalidTokenException(&quot;Invalid token (token not found)&quot;);
        } else {
            String token = (String)authentication.getPrincipal();
            OAuth2Authentication auth = this.tokenServices.loadAuthentication(token);
            .......
                    return auth;
                }
</code></pre><p>再UserInfoTokenServices:</p>
<pre><code>public OAuth2Authentication loadAuthentication(String accessToken) throws AuthenticationException, InvalidTokenException {
        Map&lt;String, Object&gt; map = this.getMap(this.userInfoEndpointUrl, accessToken);
        if(map.containsKey(&quot;error&quot;)) {
            if(this.logger.isDebugEnabled()) {
                this.logger.debug(&quot;userinfo returned error: &quot; + map.get(&quot;error&quot;));
            }

            throw new InvalidTokenException(accessToken);
        } else {
            return this.extractAuthentication(map);
        }
    }
</code></pre><p>这段很关键，<code>if(map.containsKey(&quot;error&quot;))</code></p>
<p>有这个key就会抛出InvalidTokenException异常。</p>
<p>然后当中的this.getMap(…)这个方法很重要，我们看看：</p>
<pre><code>private Map&lt;String, Object&gt; getMap(String path, String accessToken) {
        if(this.logger.isDebugEnabled()) {
            this.logger.debug(&quot;Getting user info from: &quot; + path);
        }

        try {
            OAuth2RestOperations restTemplate = this.restTemplate;
            if(restTemplate == null) {
                BaseOAuth2ProtectedResourceDetails resource = new BaseOAuth2ProtectedResourceDetails();
                resource.setClientId(this.clientId);
                restTemplate = new OAuth2RestTemplate(resource);
            }

            OAuth2AccessToken existingToken = ((OAuth2RestOperations)restTemplate).getOAuth2ClientContext().getAccessToken();
            if(existingToken == null || !accessToken.equals(existingToken.getValue())) {
                DefaultOAuth2AccessToken token = new DefaultOAuth2AccessToken(accessToken);
                token.setTokenType(this.tokenType);
                ((OAuth2RestOperations)restTemplate).getOAuth2ClientContext().setAccessToken(token);
            }

            return (Map)((OAuth2RestOperations)restTemplate).getForEntity(path, Map.class, new Object[0]).getBody();
        } catch (Exception var6) {
            this.logger.warn(&quot;Could not fetch user details: &quot; + var6.getClass() + &quot;, &quot; + var6.getMessage());
            return Collections.singletonMap(&quot;error&quot;, &quot;Could not fetch user details&quot;);
        }
    }
</code></pre><p>这个方法是调用认证服务器获取用户信息的接口，也就是我写在认证服务器的一个接口：</p>
<pre><code>@GetMapping(&quot;/userinfo&quot;)
    public Object user(Principal user){
        return user;
    }
</code></pre><p>很显然，如果我传的token是过期的token，那这个返回的user肯定是null,通过调试，果然如此，但是，按理说应该会被catch掉，但是，因为返回的是null，却没走这里，不知道为什么，可能是被其它的filter或者监听器给捕获了，那么，我只能让它不返回null，但又不能破坏oauth2原有的规则，既然是通过返回的map里面的key来判断是否有error来抛出<code>InvalidTokenException</code>异常的，那我这么改造一下：</p>
<pre><code>@GetMapping(&quot;/userinfo&quot;)
    public Object user(Principal user){
        if (user == null){
            JSONObject jsonObject = new JSONObject();
            jsonObject.put(&quot;error&quot;,&quot;未获取到用户信息&quot;);
            return jsonObject;
        }
        return user;
    }
</code></pre><p>再次访问，完美解决。。。。。</p>
<p><img src="http://img.huguiqi.top/1546878109010bsidige0.png?imageslim" alt="paste image"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2019/01/07/spring-cloud-oauth2与前端跨域问题/#comments" class="ds-thread-count comments-count-link" data-thread-key="2019/01/07/spring-cloud-oauth2与前端跨域问题/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/05/spring-cloud-security-auth2集成问题/" title="spring-cloud security+auth2集成问题" itemprop="url">spring-cloud security+auth2集成问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2018-12-05T09:55:00.000Z" itemprop="datePublished"> 发表于 2018-12-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="spring-cloud-security-auth2集成问题"><a href="#spring-cloud-security-auth2集成问题" class="headerlink" title="spring-cloud security+auth2集成问题"></a>spring-cloud security+auth2集成问题</h1><p>网络上和官网的例子都是老版本的，集成到spring cloud的2.0之后的版本有很<br>多问题，在本人集成时遇到的问题都整理起来。</p>
<h2 id="security4升级到5的问题"><a href="#security4升级到5的问题" class="headerlink" title="security4升级到5的问题"></a>security4升级到5的问题</h2><p>报错信息：</p>
<pre><code>Spring Security 5 : There is no PasswordEncoder mapped for the id “null”
</code></pre><ul>
<li>原因：</li>
</ul>
<p>security5之后不默认不允许不加密的密码和secret</p>
<ul>
<li>参考文章</li>
</ul>
<p><a href="https://stackoverflow.com/questions/49654143/spring-security-5-there-is-no-passwordencoder-mapped-for-the-id-null" target="_blank" rel="noopener">https://stackoverflow.com/questions/49654143/spring-security-5-there-is-no-passwordencoder-mapped-for-the-id-null</a></p>
<ul>
<li>解决办法：</li>
</ul>
<p>1, 添加password encoder</p>
<p>2, 设置密码时通过jsonFormat规则：{noop}secret</p>
<p>参考文章：</p>
<p><a href="https://spring.io/blog/2017/11/01/spring-security-5-0-0-rc1-released#password-storage-format" target="_blank" rel="noopener">https://spring.io/blog/2017/11/01/spring-security-5-0-0-rc1-released#password-storage-format</a></p>
<h2 id="Encoded-password-does-not-look-like-BCrypt"><a href="#Encoded-password-does-not-look-like-BCrypt" class="headerlink" title="Encoded password does not look like BCrypt"></a>Encoded password does not look like BCrypt</h2><p>也是升级问题导致，输入参数不是一个加密的格式</p>
<p>参考文章</p>
<p><a href="https://stackoverflow.com/questions/49582971/encoded-password-does-not-look-like-bcrypt" target="_blank" rel="noopener">https://stackoverflow.com/questions/49582971/encoded-password-does-not-look-like-bcrypt</a></p>
<p><a href="https://www.cnkirito.moe/spring-security-6/" target="_blank" rel="noopener">https://www.cnkirito.moe/spring-security-6/</a></p>
<h2 id="Redis存储问题"><a href="#Redis存储问题" class="headerlink" title="Redis存储问题"></a>Redis存储问题</h2><p>报错信息：</p>
<pre><code>NoSuchMethodError.RedisConnection.set([B[B)V issue
</code></pre><p>原因：<br>因为我是auth2.0的2.0.1的版本，2.x版本有一直有这个bug，直到Update spring-security-oauth2 to 2.3.3.RELEASE这个版本才fix掉</p>
<p>参考文章：<br><a href="https://github.com/spring-projects/spring-security-oauth2-boot/issues/27" target="_blank" rel="noopener">https://github.com/spring-projects/spring-security-oauth2-boot/issues/27</a></p>
<p>由于我是spring-cloud的方式集成的，我的maven pom.xml:</p>
<pre><code>&lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.1.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;spring-cloud.version&gt;Finchley.RELEASE&lt;/spring-cloud.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;redis.clients&lt;/groupId&gt;
            &lt;artifactId&gt;jedis&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
            &lt;version&gt;1.16.18&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre><p>解决办法：</p>
<ol>
<li>将springboot的版本升级到：2.1.1.RELEASE</li>
<li>将spring-cloud版本升级到：Finchley.SR2</li>
</ol>
<p>好了，再运行一遍，ok了。。。。。。</p>
<p><img src="http://img.huguiqi.top/1544004879882pt6voptb.png?imageslim" alt="paste image"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/springCloud/">springCloud</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/spring-cloud/">spring-cloud</a><a href="/tags/security/">security</a><a href="/tags/auth2/">auth2</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/12/05/spring-cloud-security-auth2集成问题/#comments" class="ds-thread-count comments-count-link" data-thread-key="2018/12/05/spring-cloud-security-auth2集成问题/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/04/JPA学习相关/" title="JPA学习相关" itemprop="url">JPA学习相关</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2018-12-04T01:59:53.000Z" itemprop="datePublished"> 发表于 2018-12-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <ul>
<li>官方文档：</li>
</ul>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/2.1.3.RELEASE/reference/html/#jpa.query-methods.named-queries" target="_blank" rel="noopener">https://docs.spring.io/spring-data/jpa/docs/2.1.3.RELEASE/reference/html/#jpa.query-methods.named-queries</a></p>
<ul>
<li>JPA结合mysql：</li>
</ul>
<p><a href="https://hellokoding.com/jpa-one-to-one-foreignkey-relationship-example-with-spring-boot-maven-and-mysql/" target="_blank" rel="noopener">https://hellokoding.com/jpa-one-to-one-foreignkey-relationship-example-with-spring-boot-maven-and-mysql/</a></p>
<ul>
<li>JPA关联关系示例</li>
</ul>
<p><a href="https://www.callicoder.com/hibernate-spring-boot-jpa-one-to-one-mapping-example/" target="_blank" rel="noopener">https://www.callicoder.com/hibernate-spring-boot-jpa-one-to-one-mapping-example/</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/12/04/JPA学习相关/#comments" class="ds-thread-count comments-count-link" data-thread-key="2018/12/04/JPA学习相关/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/11/26/7天学会使用springcloud-六/" title="7天学会使用springcloud(六)" itemprop="url">7天学会使用springcloud(六)</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2018-11-26T05:38:00.000Z" itemprop="datePublished"> 发表于 2018-11-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="7天学会使用springcloud-六"><a href="#7天学会使用springcloud-六" class="headerlink" title="7天学会使用springcloud(六)"></a>7天学会使用springcloud(六)</h1><h2 id="eureka集群配置"><a href="#eureka集群配置" class="headerlink" title="eureka集群配置"></a>eureka集群配置</h2><p>eureka的集群配置需要几个必要条件</p>
<p>支持注册中心集群</p>
<p>application.yml  available-replicas条件为： </p>
<ol>
<li>eureka.instance.appname 必须等于 spring.application.name 并且不可缺省,所以直接占位符 appname: ${spring.application.name}</li>
<li>prefer-ip-address: 必须为false 或者缺省</li>
<li>fetch-registry 必须为false 或者缺省</li>
<li>register-with-eureka: 必须为true</li>
<li>instance-id: 必须为当前可访问的服务地址，否则eureka就会被视作down的状态</li>
</ol>
<p>配置文件满足以上几个条件了，那么就可以eureka集群了：</p>
<p><img src="http://img.huguiqi.top/1543211372162gpnp4b7g.png?imageslim" alt="paste image"></p>
<p>看到general info下的environment的值是product,这个值如果在配置文件里配置：</p>
<pre><code>eureka:
      environment: product
</code></pre><p>我的服务上就会看到如下：</p>
<p><img src="http://img.huguiqi.top/1543211547827xiof9rm5.png?imageslim" alt="paste image"></p>
<h2 id="分地域分区"><a href="#分地域分区" class="headerlink" title="分地域分区"></a>分地域分区</h2><p>eureka提供了region和zone两个概念来进行分区，这两个概念均来自于亚马逊的AWS：</p>
<ul>
<li>region：可以简单理解为地理上的分区，比如亚洲地区，或者华北地区，再或者北京等等，没有具体大小的限制。根据项目具体的情况，可以自行合理划分region。</li>
<li>zone：可以简单理解为region内的具体机房，比如说region划分为北京，然后北京有两个机房，就可以在此region之下划分出zone1,zone2两个zone。</li>
</ul>
<h2 id="分区服务架构图"><a href="#分区服务架构图" class="headerlink" title="分区服务架构图"></a>分区服务架构图</h2><p><img src="http://img.huguiqi.top/1543211822262b16nl0yi.png?imageslim" alt="paste image"></p>
<p>如图所示，有一个region:beijing，下面有zone-1和zone-2两个分区，每个分区内有一个注册中心Eureka Server和一个服务提供者Service。<br>我们在zone-1内创建一个Consumer-1服务消费者的话，其会优先调用同一个zone内的Service-1，当Service-1不可用时，才会去调用zone-2内的Service-2</p>
<ol>
<li>Eureka Server-1：</li>
</ol>
<pre><code>spring:
  application:
    name: Server-1
server:
  port: 30000
eureka:
  instance:
    prefer-ip-address: true
    status-page-url-path: /actuator/info
    health-check-url-path: /actuator/health
    hostname: localhost
  client:
    register-with-eureka: true
    fetch-registry: true
    prefer-same-zone-eureka: true
    #地区
    region: beijing
    availability-zones:
      beijing: zone-1,zone-2
    service-url:
      zone-1: http://localhost:30000/eureka/
      zone-2: http://localhost:30001/eureka/
</code></pre><ol>
<li>Eureka Server-2   </li>
</ol>
<pre><code>spring:
  application:
    name: Server-2
server:
  port: 30001
eureka:
  instance:
    prefer-ip-address: true
    status-page-url-path: /actuator/info
    health-check-url-path: /actuator/health
    hostname: localhost
  client:
    register-with-eureka: true
    fetch-registry: true
    prefer-same-zone-eureka: true
    #地区
    region: beijing
    availability-zones:
      beijing: zone-2,zone-1
    service-url:
      zone-1: http://localhost:30000/eureka/
      zone-2: http://localhost:30001/eureka/
</code></pre><ol>
<li>Service-1</li>
</ol>
<pre><code>@RestController
public class HiController {
    @Value(&quot;${zone.name}&quot;)
    private String zoneName;

    @RequestMapping(value = &quot;/hi&quot;, method = RequestMethod.GET)
    public String hi() {
        return zoneName;
    }
}
</code></pre><p>配置文件：</p>
<pre><code>spring:
  application:
    name: service
server:
  port: 30010
eureka:
  instance:
    prefer-ip-address: true
    status-page-url-path: /actuator/info
    health-check-url-path: /actuator/health
    metadata-map:
      zone: zone-1
  client:
    register-with-eureka: true
    fetch-registry: true
    prefer-same-zone-eureka: true
    #地区
    region: beijing
    availability-zones:
      beijing: zone-1,zone-2
    service-url:
      zone-1: http://localhost:30000/eureka/
      zone-2: http://localhost:30001/eureka/

zone.name: zone-1
</code></pre><p><strong> ps 参考博客: </strong></p>
<p><a href="https://segmentfault.com/a/1190000014107639" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014107639</a></p>
<p><a href="https://www.jianshu.com/p/2ca32773b3e5" target="_blank" rel="noopener">https://www.jianshu.com/p/2ca32773b3e5</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/springcloud/">springcloud</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/springcloud/">springcloud</a><a href="/tags/集群/">集群</a><a href="/tags/eureka/">eureka</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/11/26/7天学会使用springcloud-六/#comments" class="ds-thread-count comments-count-link" data-thread-key="2018/11/26/7天学会使用springcloud-六/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/11/19/日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？/" title="日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？" itemprop="url">日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/109318125124422212783?rel=author" title="sam" target="_blank" itemprop="author">sam</a>
		
  <p class="article-time">
    <time datetime="2018-11-19T09:56:24.523Z" itemprop="datePublished"> 发表于 2018-11-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？"><a href="#日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？" class="headerlink" title="日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？"></a>日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？</h1><p>多图慎入，从事设计（或感兴趣的朋友）可以参考借鉴。想要明白所谓“极简主义”的设计需要从多方面观察日本设计所坚持和追求的内涵。\<br>\<br>首先提到佐藤晃一的平面设计作品，他有着明显的民族风格。不但继承了日本文化，还将这种风格更近一步提炼了日本文化中追求的宁静、虚无、空灵的境界。\<br>\</p>
<p><img src="http://pic4.zhimg.com/770364b79455183974af7355a816df57_b.jpg" alt=""></p>
<p>\</p>
<p><img src="http://pic3.zhimg.com/fbafd754151002abf882b7e66961a799_b.jpg" alt=""></p>
<p>\<br>到底追求什么境界？又有什么内涵？\<br>\<br>我们一步步来了解。日本的工业设计极具现实主义精神，其理念是回归到了产品设计本身，从人的需求出发。\<br>\<br>细读日本设计界的大师著作，能很清晰的觉察到大师身上的「反思」精神，如原研哉提出的「ReDesign」观点，把每件产品已固化已形成的形态放到一边，从最初的起点去重新审视它，才能找到新的切入点，但同时他也强调设计不是「创造新产物」。不过，在现有基础之上重新定义改良往往比创造一件新事物还要难，因为当你面对牙刷时会想它「本该如此」或「全世界的牙刷都是如此」而放弃，当回归本质时才能看到新的一面。\<br>\<br>从几位日本工业设计师的作品，我们大致可以了解「回归本质」的意思：\<br>\<br>坪井浩尚\<br>是日本的新锐设计师，他最大的特点是常将缺点转化为优点，他总是用佛教的思维思考事物。\<br>\<br>坪井浩尚注意到由于杯内和杯外的温差缘故，水杯总会在桌面上留下难看的水痕，于是干脆设计一款樱花水痕杯，即使在桌面上留下水痕也是美美的。\</p>
<p><img src="http://pic4.zhimg.com/ca79491248592f2d89136ef99b898dfc_b.jpg" alt=""></p>
<p>\<br>深泽直人\<br>他的“无意识设计”包揽了几乎世界上所有著名的设计奖项，是日本现代最为知名的设计师，看重细节的他希望可以用细节感动用户。（用心在你看不出来的细节上，让你对物对生活的感动）\<br>\<br>这个很具有鲜明的例子，像一颗巨大的鹅卵石，有玻璃纤维制成，可以当做沙发，也可以当做咖啡桌。\</p>
        
        
        <p class="article-more-link">
          
            <a href="/2018/11/19/日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/专业技术-印象笔记/">专业技术(印象笔记)</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/从印象笔记导入/">从印象笔记导入</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/11/19/日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？/#comments" class="ds-thread-count comments-count-link" data-thread-key="2018/11/19/日本设计师的极简主义设计，是否和日本民族的高密度生活状态有直接联系？/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><a class="extend next" rel="next" href="/page/3/">Next<span></span></a>
  </nav>



</div>

      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="huguiqi" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AFNetWork3-1/" title="AFNetWork3.1">AFNetWork3.1<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Alcatraz/" title="Alcatraz">Alcatraz<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/IT-运维/" title="IT&amp;运维">IT&amp;运维<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/activiti/" title="activiti">activiti<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker/" title="docker">docker<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/git/" title="git">git<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/github-博客/" title="github 博客">github 博客<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/hexo/" title="hexo">hexo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/hexo插件/" title="hexo插件">hexo插件<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/ios-Developer/" title="ios Developer">ios Developer<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/" title="java">java<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/javascript/" title="javascript">javascript<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/node/" title="node">node<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nodejs/" title="nodejs">nodejs<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/redis/" title="redis">redis<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/springCloud/" title="springCloud">springCloud<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/activiti/springboot/" title="springboot">springboot<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/springboot/" title="springboot">springboot<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/springcloud/" title="springcloud">springcloud<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/xcode/" title="xcode">xcode<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/专业技术-印象笔记/" title="专业技术(印象笔记)">专业技术(印象笔记)<sup>222</sup></a></li>
		  
		
		  
			<li><a href="/categories/前端技术/" title="前端技术">前端技术<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/大数据/" title="大数据">大数据<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/感悟/" title="感悟">感悟<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂谈/" title="杂谈">杂谈<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/科学上网/" title="科学上网">科学上网<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/站内搜索-博客/" title="站内搜索 博客">站内搜索 博客<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/管理/" title="管理">管理<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统/" title="系统">系统<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统-工具/" title="系统&amp;工具">系统&amp;工具<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统-运维/" title="系统&amp;运维">系统&amp;运维<sup>17</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络配置/" title="网络配置">网络配置<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/" title="读书笔记">读书笔记<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/面试题/" title="面试题">面试题<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/从印象笔记导入/" title="从印象笔记导入">从印象笔记导入<sup>222</sup></a></li>
			
		
			
				<li><a href="/tags/随笔/" title="随笔">随笔<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/springboot/" title="springboot">springboot<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/面试题/" title="面试题">面试题<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Rejected/" title="Rejected">Rejected<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/spring-cloud/" title="spring cloud">spring cloud<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ReactNative/" title="ReactNative">ReactNative<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/hexo/" title="hexo">hexo<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/javascript-原型编程/" title="javascript&amp;原型编程">javascript&amp;原型编程<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/jenkins/" title="jenkins">jenkins<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nodejs/" title="nodejs">nodejs<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/docker-compose/" title="docker-compose">docker-compose<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ios-developer-upload/" title="ios developer upload">ios developer upload<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/redis/" title="redis">redis<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/docker-国内镜像/" title="docker 国内镜像">docker 国内镜像<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/cordova/" title="cordova">cordova<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/科学上网/" title="科学上网">科学上网<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ios-developer-证书过期/" title="ios developer 证书过期">ios developer 证书过期<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://godeggs.cn " target="_blank" title="承接手机app、微信、web开发">找人做软件</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.huguiqi.com." target="_blank" title="sam&#39;s Blog">sam&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">豆瓣秀</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/64698454/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1601653200&verifier=bd864c6a&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Sam.This is my Blog. <br/>
			Anything that can go wrong will go wrong</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1601653200" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/huguiqi" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/XiaoheiSpring" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/sam.hu.7334" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/小黑-胡-ab83b992" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/64698454" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/hu-xiao-hei-53" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/109318125124422212783?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:guiqi.hu@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="http://blog.huguiqi.com." target="_blank" title="sam">sam</a> © 2019 
		
		<a href="/about" target="_blank" title="sam">sam</a>
		
		
		</p>
</div>

 <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','qtnHgvQyg5N9h4en-9wA','2.0.0');
</script>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f5971877c7b77f98074be3ddabf34fbe";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

    <div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//huguiqicom.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


<script id="dsq-count-scr" src="//huguiqicom.disqus.com/count.js" async></script>

    
  </body>
 </html>
